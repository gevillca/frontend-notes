<div class="p-6 bg-white dark:bg-gray-900 min-h-screen">
  <!-- Note Form Dialog -->
  <p-dialog
    [(visible)]="showNoteForm"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="w-full max-w-4xl"
    (onHide)="onCancelForm()">
    <app-note-form
      [note]="editingNote()"
      [availableTags]="allTags()"
      [preSelectedTags]="currentTagId() ? [currentTagId()!] : []"
      (save)="onSaveNote($event)"
      (formCancel)="onCancelForm()" />
  </p-dialog>

  <!-- Page Header with Search -->
  <app-page-header
    [title]="viewTitle()"
    [searchPlaceholder]="searchPlaceholder()"
    [searchValue]="notesStore.searchTerm()"
    (searchChange)="onSearchChange($event)" />

  <!-- Tag Info Banner -->
  @if (currentTag()) {
    <div
      class="bg-primary-50 dark:bg-primary-900/30 border-l-4 border-primary p-4 mb-4 rounded-r-lg">
      <div class="flex items-center">
        <i class="pi pi-tag text-primary mr-3 text-xl"></i>
        <div>
          <h3 class="text-sm font-semibold text-surface-900 dark:text-surface-0">
            Filtering by tag: {{ currentTag()!.name }}
          </h3>
          <p class="text-xs text-surface-600 dark:text-surface-400 mt-1">
            All notes with the "{{ currentTag()!.name }}" tag are shown here.
          </p>
        </div>
      </div>
    </div>
  }

  <!-- Main Content Area -->
  <div class="flex flex-1 overflow-hidden">
    <!-- Left Column: Notes List -->
    <div class="w-96 flex flex-col border-r border-surface bg-surface-card">
      <div class="flex-1 overflow-auto">
        <!-- Empty State -->
        @if (filteredNotes().length === 0) {
          <div class="flex flex-col items-center justify-center h-96 text-center p-6">
            <i class="pi pi-inbox text-8xl text-surface-300 dark:text-surface-600 mb-4"></i>
            <h3 class="text-xl font-semibold text-surface-900 dark:text-surface-0 mb-2">
              No notes found
            </h3>
            <p class="text-sm text-surface-500 dark:text-surface-400 max-w-sm mb-4">
              @if (currentTag()) {
                No notes with tag "{{ currentTag()!.name }}".
              } @else {
                No notes available for this tag.
              }
            </p>
            <p-button
              label="Create First Note"
              icon="pi pi-plus"
              severity="primary"
              (onClick)="onCreateNote()" />
          </div>
        } @else {
          <!-- Create Note Button (shown when notes exist) -->
          <div class="p-4 border-b border-surface">
            <p-button
              label="Create Note"
              icon="pi pi-plus"
              severity="primary"
              styleClass="w-full"
              (onClick)="onCreateNote()" />
          </div>
          <!-- Notes List -->
          <div class="pb-4">
            @for (note of filteredNotes(); track note.id) {
              <app-note-list-item
                [note]="note"
                [allTags]="allTags()"
                [isSelected]="selectedNote()?.id === note.id"
                (noteClick)="onNoteClick($event)" />
            }
          </div>
        }
      </div>
    </div>

    <!-- Right Column: Note Detail -->
    <div class="flex-1">
      @if (selectedNote()) {
        <app-note-detail
          [note]="selectedNote()"
          [allTags]="allTags()"
          (editNote)="onEditNote($event)"
          (archiveNote)="onArchiveNote($event)"
          (deleteNote)="onDeleteNote($event)" />
      } @else {
        <!-- Empty Selection State -->
        <div class="flex flex-col items-center justify-center h-full text-center p-8">
          <i class="pi pi-file-edit text-8xl text-surface-300 dark:text-surface-600 mb-4"></i>
          <h3 class="text-xl font-semibold text-surface-900 dark:text-surface-0 mb-2">
            Select a note to view
          </h3>
          <p class="text-sm text-surface-500 dark:text-surface-400 max-w-md">
            Choose a note from the list to see its content, or create a new one to get started.
          </p>
        </div>
      }
    </div>
  </div>
</div>
